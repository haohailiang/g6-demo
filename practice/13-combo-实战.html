<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <style>
        #container {
            border: 1px solid;
            width: calc(100vw - 50px);
            height: calc(100vh - 50px);
        }
    </style>
    <script src="../lib/g6-4.0.3.min.js"></script>
</head>

<body>
    <!-- 1. 创建容器 -->
    <div id="container"></div>
    <script>
        const data = {
            nodes: [
                {
                    id: '26',
                    size: 30,
                    label: 'Rex'
                },
                {
                    id: '0',
                    label: '10+',
                    comboId: 'a',
                    size: 32,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        style: {
                            fontSize: 12,
                            fill: '#ffffff',
                        },
                    },
                },
                {
                    id: '1',
                    label: '1',
                    comboId: 'a',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '2',
                    label: '2',
                    comboId: 'a',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '3',
                    label: '3',
                    comboId: 'a',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '4',
                    label: '4',
                    comboId: 'a',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '5',
                    label: '5',
                    comboId: 'a',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '6',
                    label: '6',
                    comboId: 'a',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '27',
                    label: '10+',
                    comboId: 'b',
                    size: 32,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        style: {
                            fontSize: 12,
                            fill: '#ffffff',
                        },
                    },
                },
                {
                    id: '16',
                    comboId: 'b',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '17',
                    comboId: 'b',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '18',
                    comboId: 'b',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '19',
                    comboId: 'b',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '33',
                    label: '10+',
                    comboId: 'c',
                    size: 32,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        style: {
                            fontSize: 12,
                            fill: '#ffffff',
                        },
                    },
                },
                // {
                //     id: '23',
                //     comboId: 'c',
                //     size: 8,
                //     style: {
                //         fill: '#86889D',
                //         lineWidth: 0,
                //     },
                //     labelCfg: {
                //         refY: 10,
                //         position: 'bottom',
                //         style: {
                //             fontSize: 12,
                //             fill: '#111111',
                //             opacity: 0.65,
                //         },
                //     },
                // },
                // {
                //     id: '27',
                //     comboId: 'c',
                //     size: 8,
                //     style: {
                //         fill: '#86889D',
                //         lineWidth: 0,
                //     },
                //     labelCfg: {
                //         refY: 10,
                //         position: 'bottom',
                //         style: {
                //             fontSize: 12,
                //             fill: '#111111',
                //             opacity: 0.65,
                //         },
                //     },
                // },
                {
                    id: '28',
                    comboId: 'c',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '29',
                    comboId: 'c',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '30',
                    comboId: 'c',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '31',
                    comboId: 'c',
                    size: 8,
                    style: {
                        fill: '#86889D',
                        lineWidth: 0,
                    },
                    labelCfg: {
                        refY: 10,
                        position: 'bottom',
                        style: {
                            fontSize: 12,
                            fill: '#111111',
                            opacity: 0.65,
                        },
                    },
                },
                {
                    id: '32',
                    label: 'haha',
                    // size: 30,
                    type: 'circle',
                    size: [160],
                    color: '#5B8FF9',
                    style: {
                        fill: '#9EC9FF',
                        lineWidth: 3,
                    },
                    labelCfg: {
                        style: {
                            fill: '#1890ff',
                            fontSize: 24,
                        },
                        position: 'bottom',
                    },
                    icon: {
                        // whether show the icon
                        show: true,
                        // icon's img address, string type
                        img:
                            'https://gw.alipayobjects.com/zos/basement_prod/012bcf4f-423b-4922-8c24-32a89f8c41ce.svg',
                        width: 60,
                        height: 60,
                    },
                },
            ],
            edges: [
                {
                    source: 'a',
                    target: '26',
                    label: 'a-26',
                },
                {
                    source: 'b',
                    target: '26',
                    label: 'b-26',
                },
                {
                    source: 'c',
                    target: '26',
                    label: 'c-26',
                },
                {
                    source: '32',
                    target: '26',
                    label: '32-26',
                },
                {
                    source: '22',
                    target: '23',
                    label: '22-23',
                },
            ],
            combos: [
                {
                    id: 'a',
                    label: 'Combo A',
                },
                {
                    id: 'b',
                    label: 'Combo B',
                },
                {
                    id: 'c',
                    label: 'Combo C',
                },
            ],
        };

        const width = document.getElementById('container').scrollWidth;
        const height = document.getElementById('container').scrollHeight || 500;
        const graph = new G6.Graph({
            container: 'container',
            width,
            height,
            fitView: true,
            fitViewPadding: 50,
            layout: {
                type: 'comboForce',
                // type: 'radial',
                // center: [100, 0],
                // type: 'force',
                // nodeStrength: 1,
                preventOverlap: true,
                preventNodeOverlap: true,
                preventComboOverlap: true,
                nodeSpacing: (d) => 8,
                comboSpacing: d => 8,
                comboPadding: d => 8,
                // gravity: 30,
                // linkDistance: 50,
                linkDistance: (d) => {
                    if (d.source === '32') {
                        console.log('%c d===', 'color:#fff;background: red;', d)
                        return 200;
                    }
                    return 30;
                },
                // nodeStrength: (d) => {
                //     // if (d.isLeaf) {
                //     //     return -50;
                //     // }
                //     return 80;
                // },
                // edgeStrength: (d) => {
                //     // if (d.source.id === 'node1' || d.source.id === 'node2' || d.source.id === 'node3') {
                //     //     return 0.7;
                //     // }
                //     return 100;
                // },
            },
            // layout: {
            //     type: 'radial',
            //     unitRadius: 50,
            //     preventOverlap: true,
            //     maxPreventOverlapIteration: 100,
            // },
            defaultNode: {
                size: 15,
                color: '#5B8FF9',
                style: {
                    lineWidth: 2,
                    fill: '#C6E5FF',
                },
            },
            defaultCombo: {
                type: 'circle',
                style: {
                    lineWidth: 1,
                },
                labelCfg: {
                    refY: 10,
                    position: 'top',
                    style: {
                        fontSize: 18,
                    },
                    refY: 25,
                    position: 'bottom',
                },
            },
            defaultEdge: {
                size: 2,
                color: '#e2e2e2',
                autoRotate: true,
                labelCfg: {
                    autoRotate: true, // 边上的标签文本根据边的方向旋转
                },
            },
            modes: {
                default: ['drag-combo', 'drag-node', 'drag-canvas', 'zoom-canvas'],
            },
            comboStateStyles: {
                // the style configurations for the hover state on the combo
                hover: {
                    lineWidth: 2,
                    stroke: '#226EDA',
                },
            },
            nodeStateStyles: {
                // the hover configurations for the hover state on the node
                hover: {
                    fill: '#226EDA',
                    // lineWidth: 3,
                },
            },
        });

        graph.data(data);
        graph.render();


        // 点击节点
        graph.on('node:click', (e) => {
            // 先将所有当前是 click 状态的节点置为非 click 状态
            // const clickNodes = graph.findAllByState('node', 'click');
            // clickNodes.forEach((cn) => {
            //     graph.setItemState(cn, 'click', false);
            // });
            const nodeItem = e.item; // 获取被点击的节点元素对象
            const model = e.item.getModel()
            console.log('%c model===', 'color:#fff;background: red;', model)
            // graph.setItemState(nodeItem, 'click', true); // 设置当前节点的 click 状态为 true
        });

        graph.on('combo:mouseenter', (evt) => {
            console.log('%c mouseenter===', 'color:#fff;background: red;')
            const { item } = evt;
            // graph.findById()
            console.log('%c item===', 'color:#fff;background: red;', item)
            graph.setItemState(item, 'hover', true);
            item._cfg.nodes.forEach(v => {
                graph.setItemState(v, 'hover', true);
            })
        });

        graph.on('combo:mouseleave', (evt) => {
            console.log('%c mouseleave===', 'color:#fff;background: red;')
            const { item } = evt;
            graph.setItemState(item, 'hover', false);
            item._cfg.nodes.forEach(v => {
                graph.setItemState(v, 'hover', false);
            })
        });

        graph.on('node:mouseenter', (evt) => {
            const { item } = evt;
            // graph.findById()
            const { comboId } = item.getModel()
            console.log('%c comboId===', 'color:#fff;background: red;', comboId)

            if (!comboId) {
                console.log('%c item===', 'color:#fff;background: red;', item)
                graph.setItemState(item, 'hover', true);
            } else {
                const combNode = graph.findById(comboId)
                graph.setItemState(combNode, 'hover', true);
                // const haha = graph.findById(comboId)
                // console.log('%c haha===', 'color:#fff;background: red;', haha)
                combNode._cfg.nodes.forEach(v => {
                    graph.setItemState(v, 'hover', true);
                })
            }
        });

        graph.on('node:mouseleave', (evt) => {
            const { item } = evt;
            const { comboId } = item.getModel()
            console.log('%c comboId===', 'color:#fff;background: red;', comboId)

            if (!comboId) {
                graph.setItemState(item, 'hover', false);
            } else {
                const combNode = graph.findById(comboId)
                graph.setItemState(combNode, 'hover', true);
                combNode._cfg.nodes.forEach(v => {
                    graph.setItemState(v, 'hover', true);
                })
            }
        });
    </script>
</body>

</html>